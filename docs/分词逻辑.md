# 分词逻辑说明

## 基本原则

1. 语义完整性：分词应尽量保持语义的完整性，避免打断自然的语言单位
2. 视觉节奏：考虑阅读时的眼动规律，使每个分组便于一次眼动捕捉
3. 标点处理：标点符号应该跟随前面的文字，不应出现在分组开头
4. 长度控制：在保证语义完整的前提下，控制每组文字的长度在合理范围内

## 分词规则

### 1. 优先级顺序
1. 段落边界（最高优先级）
2. 句子边界（句号、问号、感叹号等）
3. 从句边界（逗号、分号等）
4. 语义单位边界（介词、连词等）
5. 目标长度（最低优先级）

### 2. 长度控制
- 基准长度：由用户设置的 chunkSize 参数决定
- 浮动范围：由 flexibleRange 参数控制，默认为±1个字
- 最小长度：max(2, chunkSize - flexibleRange)
- 最大长度：chunkSize + flexibleRange

### 3. 特殊处理
1. 标点符号处理：
   - 标点符号总是附加到前一个分组的末尾
   - 可通过 hideEndPunctuation 选项控制是否显示标点

2. 句末处理：
   - 启用 sentenceBreak 时，优先在句末和段落末切分
   - 在句末切分时，即使长度未达到最小值，也允许切分

3. 语义单位识别：
   - 识别常见的语义单位（如"一个"、"可以"等）
   - 避免在语义单位中间切分

## 示例

原文：
```
一行文字往往只需要一到两次眼动就能看完。
```

分词结果：
```
[
  "一行文字往往",
  "只需要一到两次",
  "眼动就能看完。"
]
```

## 配置参数

```typescript
interface ChunkOptions {
  chunkSize: number;      // 目标分组大小
  sentenceBreak: boolean; // 是否在句末断句
  flexibleRange?: number; // 长度浮动范围
  hideEndPunctuation?: boolean; // 是否隐藏标点
  readingMode?: 'serial' | 'highlight'; // 阅读模式
  highlightStyle?: 'scroll' | 'page';   // 高亮样式
}
```

## 最近更新

2024-01-17：
- 优化了标点符号的处理逻辑，确保标点跟随前一个分组
- 改进了语义单位的识别，使分组更符合自然阅读习惯 